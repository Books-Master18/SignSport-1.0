from flask import Flask, request, jsonify, render_template
import os

# –û—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–µ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤ –≤ Flask
os.environ["TOKENIZERS_PARALLELISM"] = "false"

print("üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞...")

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
app = Flask(__name__)

# ================ –ò–ù–¢–ï–õ–õ–ï–ö–¢–£–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó–ê–¢–û–† ================

def analyze_personality(text):
    """
    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: (—Ç–∏–ø –ª–∏—á–Ω–æ—Å—Ç–∏, –∫–ª—é—á–µ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏)
    """
    text_lower = text.lower()
    
    categories = {
        "–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π": 0,
        "—Ç–≤–æ—Ä—á–µ—Å–∫–∏–π": 0,
        "–ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç": 0,
        "–∏–Ω—Ç—Ä–æ–≤–µ—Ä—Ç": 0,
        "–∫–æ–º–∞–Ω–¥–Ω—ã–π": 0,
        "–∞–Ω–∞–ª–∏—Ç–∏–∫": 0,
        "–∞—Ä—Ç–∏—Å—Ç–∏—á–Ω—ã–π": 0,
        "—Å–∏–ª–æ–≤–æ–π": 0
    }
    
    keywords = {
        "–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π": ["–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç", "–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π", "–ª–æ–≥–∏–∫–∞", "—Å—Ç—Ä–∞—Ç–µ–≥–∏—è", "—Ä–∞—Å—á–µ—Ç", "–º—ã—à–ª–µ–Ω–∏–µ"],
        "—Ç–≤–æ—Ä—á–µ—Å–∫–∏–π": ["—Ç–≤–æ—Ä—á–µ—Å–∫–∏–π", "–∫—Ä–µ–∞—Ç–∏–≤", "–∞—Ä—Ç–∏—Å—Ç–∏–∑–º", "—Ñ–∞–Ω—Ç–∞–∑–∏—è", "–∏–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏—è", "—ç–∫—Å–ø—Ä–µ—Å—Å–∏–≤–Ω—ã–π"],
        "–ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç": ["–ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏–∑–º", "—Ç–æ—á–Ω–æ—Å—Ç—å", "–±–µ–∑—É–ø—Ä–µ—á–Ω–æ—Å—Ç—å", "—Ç–µ—Ö–Ω–∏–∫–∞", "–ø—Ä–∞–≤–∏–ª–∞", "—Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã"],
        "–∏–Ω—Ç—Ä–æ–≤–µ—Ä—Ç": ["–∏–Ω—Ç—Ä–æ–≤–µ—Ä—Ç", "–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π", "—Å–∞–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å", "–æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ", "–º–æ–Ω–æ—Ç–æ–Ω", "—Å–ø–æ–∫–æ–π–Ω—ã–π"],
        "–∫–æ–º–∞–Ω–¥–Ω—ã–π": ["–∫–æ–º–∞–Ω–¥–∞", "–æ–±—â–∏—Ç–µ–ª—å–Ω—ã–π", "—ç–∫—Å—Ç—Ä–∞–≤–µ—Ä—Ç", "—Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ", "–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ"],
        "–∞–Ω–∞–ª–∏—Ç–∏–∫": ["–∞–Ω–∞–ª–∏–∑", "—Å–∏—Å—Ç–µ–º–Ω—ã–π", "—Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π", "—Å—Ç—Ä—É–∫—Ç—É—Ä–∞", "–ø–æ—Ä—è–¥–æ–∫", "–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å"],
        "–∞—Ä—Ç–∏—Å—Ç–∏—á–Ω—ã–π": ["–∞—Ä—Ç–∏—Å—Ç–∏–∑–º", "—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π", "–≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–π", "–ø–ª–∞—Å—Ç–∏–∫–∞", "—Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π", "—Å—Ü–µ–Ω–∏—á–µ—Å–∫–∏–π"],
        "—Å–∏–ª–æ–≤–æ–π": ["—Å–∏–ª–∞", "–≤–æ–ª—è", "–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞", "—É–ø–æ—Ä—Å—Ç–≤–æ", "–ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ", "–≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å"]
    }
    
    for category, words in keywords.items():
        for word in words:
            if word in text_lower:
                categories[category] += 1
    
    sorted_categories = sorted(categories.items(), key=lambda x: x[1], reverse=True)
    dominant_type = sorted_categories[0][0] if sorted_categories[0][1] > 0 else "—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π"
    
    return dominant_type, categories


def get_sport_recommendations(personality_type, category_scores):
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–ø–æ—Ä—Ç—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
    """
    sport_matrix = {
        "–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π": [
            {"sport": "–®–∞—Ö–º–∞—Ç—ã", "confidence": 92, "reason": "–í–∞—à –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —É–º –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è —à–∞—Ö–º–∞—Ç."},
            {"sport": "–§–µ—Ö—Ç–æ–≤–∞–Ω–∏–µ", "confidence": 78, "reason": "–¢–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ –∏ —Å–∞–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å –¥–µ–ª–∞—é—Ç –≤–∞—Å –æ—Ç–ª–∏—á–Ω—ã–º —Ñ–µ—Ö—Ç–æ–≤–∞–ª—å—â–∏–∫–æ–º."},
            {"sport": "–¢—è–∂–µ–ª–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞", "confidence": 65, "reason": "–ú–µ—Ç–æ–¥–∏—á–Ω–æ—Å—Ç—å –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –ø–æ–º–æ–≥—É—Ç –≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Å–∏–ª–æ–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤."}
        ],
        "—Ç–≤–æ—Ä—á–µ—Å–∫–∏–π": [
            {"sport": "–§–∏–≥—É—Ä–Ω–æ–µ –∫–∞—Ç–∞–Ω–∏–µ", "confidence": 88, "reason": "–ê—Ä—Ç–∏—Å—Ç–∏–∑–º –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî –∫–ª—é—á –∫ —É—Å–ø–µ—Ö—É –≤ —Ñ–∏–≥—É—Ä–Ω–æ–º –∫–∞—Ç–∞–Ω–∏–∏."},
            {"sport": "–ê–∫—Ä–æ–±–∞—Ç–∏–∫–∞", "confidence": 85, "reason": "–¢–≤–æ—Ä—á–µ—Å–∫–∞—è –Ω–∞—Ç—É—Ä–∞ –∏ –ø–ª–∞—Å—Ç–∏–∫–∞ –∏–¥–µ–∞–ª—å–Ω—ã –¥–ª—è –∞–∫—Ä–æ–±–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–π."},
            {"sport": "–¢–µ–Ω–Ω–∏—Å", "confidence": 72, "reason": "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∏ —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –≥–∏–±–∫–æ—Å—Ç—å –ø–æ–º–æ–≥—É—Ç –≤ —Ç–µ–Ω–Ω–∏—Å–µ."}
        ],
        "–ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç": [
            {"sport": "–§–µ—Ö—Ç–æ–≤–∞–Ω–∏–µ", "confidence": 90, "reason": "–¢–æ—á–Ω–æ—Å—Ç—å, —Ç–µ—Ö–Ω–∏–∫–∞ –∏ —Å–∞–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å ‚Äî –≤–∞—à–∏ –≥–ª–∞–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞."},
            {"sport": "–§–∏–≥—É—Ä–Ω–æ–µ –∫–∞—Ç–∞–Ω–∏–µ", "confidence": 82, "reason": "–°—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤—É –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ñ–∏–≥—É—Ä–Ω–æ–≥–æ –∫–∞—Ç–∞–Ω–∏—è."},
            {"sport": "–¢—è–∂–µ–ª–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞", "confidence": 79, "reason": "–ú–µ—Ç–æ–¥–∏—á–Ω–æ—Å—Ç—å –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –ø—Ä–∏–≤–µ–¥—É—Ç –∫ –æ—Ç–ª–∏—á–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –≤ —Ç—è–∂–µ–ª–æ–π –∞—Ç–ª–µ—Ç–∏–∫–µ."}
        ],
        "–∏–Ω—Ç—Ä–æ–≤–µ—Ä—Ç": [
            {"sport": "–ü–ª–∞–≤–∞–Ω–∏–µ", "confidence": 91, "reason": "–ò–Ω—Ç—Ä–æ–≤–µ—Ä—Å–∏—è –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –¥–µ–ª–∞—é—Ç –ø–ª–∞–≤–∞–Ω–∏–µ –∏–¥–µ–∞–ª—å–Ω—ã–º –≤—ã–±–æ—Ä–æ–º."},
            {"sport": "–®–∞—Ö–º–∞—Ç—ã", "confidence": 83, "reason": "–£—Å–∏–¥—á–∏–≤–æ—Å—Ç—å –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–∫–ª–∞–¥ —É–º–∞ ‚Äî –∫–∞—á–µ—Å—Ç–≤–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ —à–∞—Ö–º–∞—Ç–∏—Å—Ç–∞."},
            {"sport": "–¢—è–∂–µ–ª–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞", "confidence": 76, "reason": "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∏ —Å–∞–º–æ–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –ø–æ–º–æ–≥—É—Ç –≤ —Ç—è–∂–µ–ª–æ–π –∞—Ç–ª–µ—Ç–∏–∫–µ."}
        ],
        "–∫–æ–º–∞–Ω–¥–Ω—ã–π": [
            {"sport": "–§—É—Ç–±–æ–ª", "confidence": 89, "reason": "–û–±—â–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –∫–æ–º–∞–Ω–¥–Ω—ã–π –¥—É—Ö ‚Äî –æ—Å–Ω–æ–≤–∞ —É—Å–ø–µ—Ö–∞ –≤ —Ñ—É—Ç–±–æ–ª–µ."},
            {"sport": "–í–æ–ª–µ–π–±–æ–ª", "confidence": 81, "reason": "–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –∏ —É–º–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –∫–æ–º–∞–Ω–¥–µ –∏–¥–µ–∞–ª—å–Ω—ã –¥–ª—è –≤–æ–ª–µ–π–±–æ–ª–∞."},
            {"sport": "–•–æ–∫–∫–µ–π", "confidence": 77, "reason": "–≠–Ω–µ—Ä–≥–∏—á–Ω–æ—Å—Ç—å –∏ —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–º–æ–≥—É—Ç –≤ —Ö–æ–∫–∫–µ–µ."}
        ],
        "–∞–Ω–∞–ª–∏—Ç–∏–∫": [
            {"sport": "–®–∞—Ö–º–∞—Ç—ã", "confidence": 95, "reason": "–°–∏—Å—Ç–µ–º–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ ‚Äî –≤–∞—à–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã."},
            {"sport": "–§–µ—Ö—Ç–æ–≤–∞–Ω–∏–µ", "confidence": 80, "reason": "–£–º–µ–Ω–∏–µ –ø—Ä–æ—Å—á–∏—Ç—ã–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ñ–µ—Ö—Ç–æ–≤–∞–Ω–∏—è."},
            {"sport": "–ü–ª–∞–≤–∞–Ω–∏–µ", "confidence": 71, "reason": "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ –∏ —Å–∞–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–º–æ–≥—É—Ç –≤ –ø–ª–∞–≤–∞–Ω–∏–∏."}
        ],
        "–∞—Ä—Ç–∏—Å—Ç–∏—á–Ω—ã–π": [
            {"sport": "–§–∏–≥—É—Ä–Ω–æ–µ –∫–∞—Ç–∞–Ω–∏–µ", "confidence": 87, "reason": "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –∞—Ä—Ç–∏—Å—Ç–∏–∑–º ‚Äî –∫–ª—é—á–µ–≤—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞."},
            {"sport": "–ê–∫—Ä–æ–±–∞—Ç–∏–∫–∞", "confidence": 84, "reason": "–ü–ª–∞—Å—Ç–∏–∫–∞ –∏ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ –∏–¥–µ–∞–ª—å–Ω—ã –¥–ª—è –∞–∫—Ä–æ–±–∞—Ç–∏–∫–∏."},
            {"sport": "–¢–µ–Ω–Ω–∏—Å", "confidence": 69, "reason": "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –∏ —ç—Å—Ç–µ—Ç–∏–∫–∞ –¥–≤–∏–∂–µ–Ω–∏–π –ø–æ–º–æ–≥—É—Ç –≤ —Ç–µ–Ω–Ω–∏—Å–µ."}
        ],
        "—Å–∏–ª–æ–≤–æ–π": [
            {"sport": "–¢—è–∂–µ–ª–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞", "confidence": 88, "reason": "–°–∏–ª–∞ –≤–æ–ª–∏ –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ ‚Äî –æ—Å–Ω–æ–≤–∞ —É—Å–ø–µ—Ö–∞ –≤ —Ç—è–∂–µ–ª–æ–π –∞—Ç–ª–µ—Ç–∏–∫–µ."},
            {"sport": "–•–æ–∫–∫–µ–π", "confidence": 75, "reason": "–§–∏–∑–∏—á–µ—Å–∫–∞—è –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å –∏ —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–º–æ–≥—É—Ç –≤ —Ö–æ–∫–∫–µ–µ."},
            {"sport": "–§—É—Ç–±–æ–ª", "confidence": 70, "reason": "–≠–Ω–µ—Ä–≥–∏—á–Ω–æ—Å—Ç—å –∏ —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ—Å—Ç—å ‚Äî –∫–∞—á–µ—Å—Ç–≤–∞ —Ö–æ—Ä–æ—à–µ–≥–æ —Ñ—É—Ç–±–æ–ª–∏—Å—Ç–∞."}
        ],
        "—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π": [
            {"sport": "–ü–ª–∞–≤–∞–Ω–∏–µ", "confidence": 78, "reason": "–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≤–∏–¥ —Å–ø–æ—Ä—Ç–∞, –ø–æ–¥—Ö–æ–¥—è—â–∏–π –±–æ–ª—å—à–∏–Ω—Å—Ç–≤—É –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ç–∏–ø–æ–≤."},
            {"sport": "–¢–µ–Ω–Ω–∏—Å", "confidence": 72, "reason": "–°–æ—á–µ—Ç–∞–Ω–∏–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –∏ —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞–≤—ã–∫–æ–≤."},
            {"sport": "–í–æ–ª–µ–π–±–æ–ª", "confidence": 68, "reason": "–ö–æ–º–∞–Ω–¥–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–∏."}
        ]
    }
    
    return sport_matrix.get(personality_type, sport_matrix["—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π"])


def filter_sports_by_age_gender(recommendations, age, gender):
    """
    –§–∏–ª—å—Ç—Ä—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É –∏ –ø–æ–ª—É —Å–æ–≥–ª–∞—Å–Ω–æ –¥–∞–Ω–Ω—ã–º –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Excel.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫.
    """
    if age is None or gender is None:
        return recommendations

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–æ–∑—Ä–∞—Å—Ç–Ω—É—é –≥—Ä—É–ø–ø—É
    if 7 <= age <= 10:
        age_group = "7‚Äì10"
    elif 11 <= age <= 14:
        age_group = "11‚Äì14"
    elif 15 <= age <= 17:
        age_group = "15‚Äì17"
    elif 18 <= age <= 25:
        age_group = "18‚Äì25"
    elif 26 <= age <= 35:
        age_group = "26‚Äì35"
    else:
        age_group = "35+"

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–ª —Å —É—á—ë—Ç–æ–º –≤–æ–∑—Ä–∞—Å—Ç–∞
    if age_group == "7‚Äì10":
        gender_label = "–ú–∞–ª—å—á–∏–∫–∏" if gender == "male" else "–î–µ–≤–æ—á–∫–∏"
    elif age_group == "11‚Äì14":
        gender_label = "–ú–∞–ª—å—á–∏–∫–∏" if gender == "male" else "–î–µ–≤–æ—á–∫–∏"
    elif age_group == "15‚Äì17":
        gender_label = "–Æ–Ω–æ—à–∏" if gender == "male" else "–î–µ–≤—É—à–∫–∏"
    elif age_group in ("18‚Äì25", "26‚Äì35"):
        gender_label = "–ú—É–∂—á–∏–Ω—ã" if gender == "male" else "–ñ–µ–Ω—â–∏–Ω—ã"
    else:  # 35+
        gender_label = "–û–±–∞ –ø–æ–ª–∞"

    # –°–ª–æ–≤–∞—Ä—å **–∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö** –≤–∏–¥–æ–≤ —Å–ø–æ—Ä—Ç–∞ –ø–æ –≥—Ä—É–ø–ø–∞–º
    forbidden_map = {
        ("7‚Äì10", "–ú–∞–ª—å—á–∏–∫–∏"): {"–¢—è–∂–µ–ª–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞", "–§–µ—Ö—Ç–æ–≤–∞–Ω–∏–µ", "–•–æ–∫–∫–µ–π"},
        ("7‚Äì10", "–î–µ–≤–æ—á–∫–∏"): {"–¢—è–∂–µ–ª–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞", "–•–æ–∫–∫–µ–π", "–ì–∞–Ω–¥–±–æ–ª", "–í–æ–¥–Ω–æ–µ –ø–æ–ª–æ"},
        ("11‚Äì14", "–î–µ–≤–æ—á–∫–∏"): {"–¢—è–∂–µ–ª–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞", "–•–æ–∫–∫–µ–π"},
        ("15‚Äì17", "–î–µ–≤—É—à–∫–∏"): {"–•–æ–∫–∫–µ–π", "–ì–∞–Ω–¥–±–æ–ª"},
        ("18‚Äì25", "–ñ–µ–Ω—â–∏–Ω—ã"): {"–•–æ–∫–∫–µ–π"},
        ("26‚Äì35", "–ñ–µ–Ω—â–∏–Ω—ã"): {"–•–æ–∫–∫–µ–π", "–¢—è–∂–µ–ª–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞"},
        ("35+", "–û–±–∞ –ø–æ–ª–∞"): {"–¢—è–∂–µ–ª–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞", "–•–æ–∫–∫–µ–π", "–§—É—Ç–±–æ–ª", "–ì–∞–Ω–¥–±–æ–ª", "–í–æ–¥–Ω–æ–µ –ø–æ–ª–æ"},
    }

    forbidden = forbidden_map.get((age_group, gender_label), set())
    filtered = [rec for rec in recommendations if rec["sport"] not in forbidden]

    # –ï—Å–ª–∏ –≤—Å—ë –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª–æ—Å—å ‚Äî –æ—Å—Ç–∞–≤–∏—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é
    if not filtered:
        return recommendations[:1]

    return filtered


# ================ –ú–ê–†–®–†–£–¢–´ FLASK ================

@app.route('/')
def home():
    return render_template('SignSport-1.0.html')

@app.route('/analyze')
def analyze_page():
    return render_template('neural_network.html')

@app.route('/api/analyze', methods=['POST'])
def analyze_text():
    try:
        data = request.get_json()
        text = data.get('text', '').strip()
        
        if not text:
            return jsonify({"error": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞."}), 400
        
        print(f"üß† –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ç–µ–∫—Å—Ç –¥–ª–∏–Ω–æ–π {len(text)} —Å–∏–º–≤–æ–ª–æ–≤...")
        
        # –ü–æ–ª—É—á–∞–µ–º –≤–æ–∑—Ä–∞—Å—Ç –∏ –ø–æ–ª –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
        age_input = data.get('age')
        gender_input = data.get('gender')

        age = int(age_input) if age_input and str(age_input).isdigit() else None
        gender = gender_input if gender_input in ("male", "female") else None

        # –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞
        personality_type, category_scores = analyze_personality(text)
        recommendations = get_sport_recommendations(personality_type, category_scores)

        # –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É –∏ –ø–æ–ª—É
        filtered_recommendations = filter_sports_by_age_gender(recommendations, age, gender)

        # –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
        main_recommendation = filtered_recommendations[0]
        additional_recommendations = [
            {"sport": rec["sport"], "confidence": rec["confidence"]}
            for rec in filtered_recommendations[1:]
        ]

        reason_text = main_recommendation["reason"]
        if age is not None and gender is not None:
            reason_text += " (–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–¥ –≤–æ–∑—Ä–∞—Å—Ç –∏ –ø–æ–ª.)"

        return jsonify({
            "success": True,
            "sport": main_recommendation["sport"],
            "confidence": main_recommendation["confidence"],
            "reason": reason_text,
            "personality_type": personality_type,
            "additional_recommendations": additional_recommendations,
            "analysis_method": "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ + –¥–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è"
        })

    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –≤ /api/analyze: {e}")
        return jsonify({"error": "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Ç–µ–∫—Å—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."}), 500


# ================ –ó–ê–ü–£–°–ö –°–ï–†–í–ï–†–ê ================

if __name__ == '__main__':
    print("\n" + "="*50)
    print("üß† SignSport Intelligence System")
    print("üëâ –°–∏—Å—Ç–µ–º–∞ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ —Å–ø–æ—Ä—Ç–∞")
    print("üëâ –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:5000")
    print("="*50 + "\n")
    app.run(debug=True, host='0.0.0.0', port=5000)